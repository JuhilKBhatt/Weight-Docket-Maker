<!DOCTYPE html>
<html lang="en">
<head>
    <title>Docket {{ docket.scrdkt_number }}</title>
    <meta charset="UTF-8">
    <style>
        {{ css_content }}
    </style>
</head>
<body class="{% if items|length <= 5 %}layout-5{% elif items|length <= 10 %}layout-10{% elif items|length <= 15 %}layout-15{% elif items|length <= 20 %}layout-20{% elif items|length <= 25 %}layout-25{% elif items|length <= 30 %}layout-30{% elif items|length <= 35 %}layout-35{% else %}layout-40{% endif %}">
    <table class="header-layout-table">
        <tr>
            <td rowspan="2" class="title-cell" style="width: 60%;">
                {% if docket.docket_type == 'Weight' %}
                    <h1>Weight Docket</h1>
                {% else %}
                    <h1>Purchase Receipt</h1>
                {% endif %}
            </td>
            
            <td style="width: 40%;">
                <div class="docket-id">ID #: {{ docket.scrdkt_number }}</div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="sub-info">Date: {{ formatted_date }} | {{docket.docket_time}}</div>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <div class="company-block-container">
                    {% if recycling_icon %}
                        <div>
                            <img src="data:image/png;base64,{{ recycling_icon }}" class="company-logo" alt="Logo" />
                        </div>
                    {% endif %}

                    <div class="company-text">
                        <h2>{{ docket.company_name or "" }}</h2>
                        <div class="sub-info">
                            Address: {{ docket.company_address or "" }} <br>
                            ABN: {{ docket.company_abn or "" }} | Phone No: {{ docket.company_phone or "" }} | 
                            Email: {{ docket.company_email or "" }}
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    </table>

    <div class="customer-section">
        <div>
            <strong>Customer Name:</strong> {{ docket.customer_name }}
        </div>
        <div class="other-info-box">
            <strong>Other Information:</strong>
            
            <span class="other-info-label">DOB:</span>
            <span class="other-info-val">{{ docket.customer_dob or '' }}</span>|
            
            <span class="other-info-label">License No.:</span>
            <span class="other-info-val">{{ docket.customer_license_no }}</span>|
            
            <span class="other-info-label">Rego No.:</span>
            <span class="other-info-val">{{ docket.customer_rego_no }}</span>|
            
            <span class="other-info-label">PayID:</span>
            <span class="other-info-val">{{ docket.customer_pay_id }}</span>|
            
            <span class="other-info-label">Phone No.:</span>
            <span class="other-info-val">{{ docket.customer_phone }}</span>|
            
            <span class="other-info-label">ABN:</span>
            <span class="other-info-val">{{ docket.customer_abn }}</span>|
            
            <span class="other-info-label">BSB:</span>
            <span class="other-info-val">{{docket.bank_bsb}}</span>|
            
            <span class="other-info-label">Acc No.:</span>
            <span class="other-info-val">{{ docket.bank_account_number }}</span>|
            
            <span class="other-info-label">Address:</span>
            <span class="other-info-val">{{docket.customer_address}}</span>|
            
            <span class="other-info-label">Notes:</span>
            <span class="other-info-val">{{ docket.notes }}</span>
        </div>
    </div>

    <table class="data-table">
        <thead>
            <tr>
                <th style="width: 6%; text-align: center;">#</th>
                <th style="width: 18%; text-align: center;">Metal</th>
                <th style="width: 20%; text-align: center;">Notes</th>
                <th style="width: 12%; text-align: center;">Gross</th>
                <th style="width: 12%; text-align: center;">Tare</th>
                <th style="width: 12%; text-align: center;">Net</th>
                <th style="width: 8%; text-align: center;">{{ currency_label }}/Unit</th>
                <th style="width: 12%; text-align: center;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td style="text-align: center;">{{ loop.index }}</td>
                <td>{{ item.metal }}</td>
                <td>{{ item.notes or '' }}</td>
                <td>{{ "{:,.0f}".format(item.gross) }} {{ item.unit }}</td>
                <td>{{ "{:,.0f}".format(item.tare) }} {{ item.unit }}</td>
                <td><strong>{{ "{:,.0f}".format(item.net) }} {{ item.unit }}</strong></td>
                <td>{{ currency_label }}{{ "{:,.2f}".format(item.price) }}</td>
                <td>{{ currency_label }}{{ "{:,.2f}".format(item.total) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <table style="width: 100%; border-collapse: collapse; border: none; margin-top: 5px;">
        <tr>
            <td style="width: 50%; vertical-align: top; border: none;">
                <div style="width: 200px; text-align: center;">
                    <div style="font-size: 8pt; font-weight: bold;">Staff + Customer Signature</div>
                    <div class="signature-line" style="width: 100%; border-top: 1px solid #000; margin-bottom: 5px;"></div>
                </div>
            </td>

            <td style="width: 50%; vertical-align: top; border: none;">
                <div class="totals-section">    
                    
                    {% if pre_deductions %}
                        <div class="totals-row">Items Total: {{ currency_label }}{{ "{:,.2f}".format(totals.itemsTotal) }}</div>
                        <div style="border-top: 1px solid #ccc;"></div>
                        {% for d in pre_deductions %}
                            <div class="totals-deduction">{{ d.label }}: -{{ currency_label }}{{ "{:,.2f}".format(d.amount) }}</div>
                        {% endfor %}
                        <div style="border-top: 1px solid #ccc;"></div>
                        <div class="totals-subtotal" style="display: inline-block; margin-top: 2px; padding-top: 2px;">Subtotal: {{ currency_label }}{{ "{:,.2f}".format(totals.grossTotal) }}</div>
                    {% else %}
                        {% if docket.include_gst %}
                            <div class="totals-row">Subtotal: {{ currency_label }}{{ "{:,.2f}".format(totals.grossTotal) }}</div>
                        {% endif %}
                    {% endif %}

                    {% if docket.include_gst %}
                        <div class="totals-gst">GST {{docket.gst_percentage}}%: {{ currency_label }}{{ "{:,.2f}".format(totals.gstAmount) }}</div>
                        
                        <div class="totals-row" style="font-weight: bold; margin-top: 2px;">Total (Inc GST): {{ currency_label }}{{ "{:,.2f}".format(totals.totalIncGst) }}</div>
                    {% endif %}

                    {% if post_deductions %}
                        <div style="border-top: 1px solid #ccc;"></div>
                        {% for d in post_deductions %}
                            <div class="totals-deduction">{{ d.label }}: -{{ currency_label }}{{ "{:,.2f}".format(d.amount) }}</div>
                        {% endfor %}
                    {% endif %}

                    <div class="totals-final" style="border-top: 1px solid #ccc;">Final Total: {{ currency_label }}{{ "{:,.2f}".format(totals.finalTotal) }}</div>
                </div>
            </td>
        </tr>
    </table>
</body>
</html>